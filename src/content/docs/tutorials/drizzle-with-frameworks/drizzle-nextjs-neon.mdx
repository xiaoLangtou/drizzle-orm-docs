---
title: "ä½¿ç”¨ Neon Postgres æ„å»ºå¾…åŠäº‹é¡¹åº”ç”¨"
date: "2024-01-17"
svgs: ['<svg width="160" height="160" viewBox="0 0 160 160" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="9.63139" height="40.8516" rx="4.8157" transform="matrix(0.873028 0.48767 -0.497212 0.867629 43.4805 67.3037)" fill="currentColor"></rect><rect width="9.63139" height="40.8516" rx="4.8157" transform="matrix(0.873028 0.48767 -0.497212 0.867629 76.9395 46.5342)" fill="currentColor"></rect><rect width="9.63139" height="40.8516" rx="4.8157" transform="matrix(0.873028 0.48767 -0.497212 0.867629 128.424 46.5352)" fill="currentColor"></rect><rect width="9.63139" height="40.8516" rx="4.8157" transform="matrix(0.873028 0.48767 -0.497212 0.867629 94.957 67.3037)" fill="currentColor"></rect></svg>', '<svg width="256" height="256" viewBox="0 0 256 256" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_84_2)"><path d="M128 256C198.692 256 256 198.692 256 128C256 57.3075 198.692 0 128 0C57.3075 0 0 57.3075 0 128C0 198.692 57.3075 256 128 256Z" fill="black"/><path d="M212.63 224.03L98.34 76.8H76.8V179.16H94.03V98.68L199.11 234.45C203.85 231.27 208.37 227.79 212.63 224.03Z" fill="url(#paint0_linear_84_2)"/><path d="M180.63 76.8H163.56V179.2H180.63V76.8Z" fill="url(#paint1_linear_84_2)"/></g><defs><linearGradient id="paint0_linear_84_2" x1="132.707" y1="181.561" x2="178.076" y2="237.79" gradientUnits="userSpaceOnUse"><stop stop-color="white"/><stop offset="1" stop-color="white" stop-opacity="0"/></linearGradient><linearGradient id="paint1_linear_84_2" x1="172.083" y1="76.7712" x2="171.776" y2="151.973" gradientUnits="userSpaceOnUse"><stop stop-color="white"/><stop offset="1" stop-color="white" stop-opacity="0"/></linearGradient><clipPath id="clip0_84_2"><rect width="256" height="256" fill="white"/></clipPath></defs></svg>', '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2 6.27586C2 4.46665 3.54385 3 5.44828 3H18.5517C20.4562 3 22 4.46665 22 6.27586V16.8631C22 18.7349 19.5068 19.5471 18.2976 18.0694L14.5173 13.4496V19.0517C14.5173 20.68 13.1278 22 11.4138 22H5.44828C3.54385 22 2 20.5333 2 18.7241V6.27586ZM5.44828 5.62069C5.06739 5.62069 4.75863 5.91402 4.75863 6.27586V18.7241C4.75863 19.086 5.06739 19.3793 5.44828 19.3793H11.5172C11.7077 19.3793 11.7586 19.2327 11.7586 19.0517V11.5393C11.7586 9.66758 14.2518 8.8552 15.461 10.333L19.2414 14.9528V6.27586C19.2414 5.91402 19.2774 5.62069 18.8966 5.62069H5.44828Z" fill="currentColor"/></svg>']
---

import Steps from "@mdx/Steps.astro";
import Npm from "@mdx/Npm.astro";
import CodeTabs from "@mdx/CodeTabs.astro";
import CodeTab from "@mdx/CodeTab.astro";
import Section from "@mdx/Section.astro";
import Tabs from "@mdx/Tabs.astro";
import Tab from "@mdx/Tab.astro";
import Prerequisites from "@mdx/Prerequisites.astro";
import Callout from "@mdx/Callout.astro";

æœ¬æ•™ç¨‹æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ **Drizzle ORM** ä¸ **Neon æ•°æ®åº“**å’Œ **Next.js** æ„å»ºä¸€ä¸ª`å¾…åŠäº‹é¡¹åº”ç”¨`ã€‚

<Prerequisites>  
  - ä½ åº”è¯¥å·²ç»æœ‰ä¸€ä¸ªç°æœ‰çš„ Next.js é¡¹ç›®æˆ–ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ï¼š
  ```bash
  npx create-next-app@latest --typescript
  ```

  - ä½ åº”è¯¥å·²ç»å®‰è£…äº† Drizzle ORM å’Œ [Drizzle kit](/docs/kit-overview)ã€‚ä½ å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®Œæˆå®‰è£…ï¼š
  <Npm>
    drizzle-orm 
    -D drizzle-kit
  </Npm>

  - ä½ åº”è¯¥å·²ç»å®‰è£…äº† [Neon serverless é©±åŠ¨](https://neon.tech/docs/serverless/serverless-driver)ã€‚
  <Npm>
    @neondatabase/serverless
  </Npm>

  - ä½ åº”è¯¥å·²ç»å®‰è£…äº†ç”¨äºç®¡ç†ç¯å¢ƒå˜é‡çš„ `dotenv` åŒ…ã€‚
  <Npm>
    dotenv
  </Npm>  
</Prerequisites>

<Callout type="warning">
å¦‚æœä½ åœ¨å®‰è£…ä¾èµ–æ—¶é‡åˆ°é—®é¢˜ï¼š

å¦‚æœä½ ä¸æ˜¯ä½¿ç”¨ React Nativeï¼Œå¯ä»¥ä½¿ç”¨ `--force` æˆ– `--legacy-peer-deps` å¼ºåˆ¶å®‰è£…æ¥è§£å†³é—®é¢˜ã€‚å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ React Nativeï¼Œé‚£ä¹ˆä½ éœ€è¦ä½¿ç”¨ä¸ä½ çš„ React Native ç‰ˆæœ¬å…¼å®¹çš„ç¡®åˆ‡ React ç‰ˆæœ¬ã€‚
</Callout>

## è®¾ç½® Neon å’Œ Drizzle ORM

<Steps>
#### åˆ›å»ºæ–°çš„ Neon é¡¹ç›®

ç™»å½•åˆ° [Neon æ§åˆ¶å°](https://console.neon.tech/app/projects) å¹¶å¯¼èˆªåˆ°é¡¹ç›®éƒ¨åˆ†ã€‚é€‰æ‹©ä¸€ä¸ªé¡¹ç›®æˆ–ç‚¹å‡» `New Project` æŒ‰é’®åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ã€‚

ä½ çš„ Neon é¡¹ç›®ä¼šè‡ªå¸¦ä¸€ä¸ªåä¸º `neondb` çš„å¯ç”¨ Postgres æ•°æ®åº“ã€‚æˆ‘ä»¬å°†åœ¨æœ¬æ•™ç¨‹ä¸­ä½¿ç”¨å®ƒã€‚

#### è®¾ç½®è¿æ¥å­—ç¬¦ä¸²å˜é‡

åœ¨é¡¹ç›®æ§åˆ¶å°çš„ **Connection Details** éƒ¨åˆ†æ‰¾åˆ°ä½ çš„æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ã€‚å®ƒåº”è¯¥ç±»ä¼¼äºè¿™æ ·ï¼š

```bash
postgres://username:password@ep-cool-darkness-123456.us-east-2.aws.neon.tech/neondb
```

å°† `DATABASE_URL` ç¯å¢ƒå˜é‡æ·»åŠ åˆ°ä½ çš„ `.env` æˆ– `.env.local` æ–‡ä»¶ä¸­ï¼Œä½ å°†ä½¿ç”¨å®ƒæ¥è¿æ¥ Neon æ•°æ®åº“ã€‚

```bash
DATABASE_URL=NEON_DATABASE_CONNECTION_STRING
```

#### å°† Drizzle ORM è¿æ¥åˆ°ä½ çš„æ•°æ®åº“

åœ¨ä½ çš„ `src/db` æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ª `drizzle.ts` æ–‡ä»¶å¹¶è®¾ç½®ä½ çš„æ•°æ®åº“é…ç½®ï¼š

```tsx copy filename="src/db/drizzle.ts"
import { config } from "dotenv";
import { drizzle } from 'drizzle-orm/neon-http';

config({ path: ".env" }); // æˆ– .env.local

export const db = drizzle(process.env.DATABASE_URL!);
```

#### å£°æ˜å¾…åŠäº‹é¡¹æ¨¡å¼

```tsx copy filename="src/db/schema.ts"
import { integer, text, boolean, pgTable } from "drizzle-orm/pg-core";

export const todo = pgTable("todo", {
  id: integer("id").primaryKey(),
  text: text("text").notNull(),
  done: boolean("done").default(false).notNull(),
});
```

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ Drizzle ORM çš„æ•°æ®ç±»å‹å®šä¹‰äº†å¸¦æœ‰ **`id`**ã€**`text`** å’Œ **`done`** å­—æ®µçš„ **`todo`** è¡¨ã€‚

#### è®¾ç½® Drizzle é…ç½®æ–‡ä»¶

**Drizzle é…ç½®** - ä¸€ä¸ªç”± [Drizzle Kit](/docs/kit-overview) ä½¿ç”¨çš„é…ç½®æ–‡ä»¶ï¼ŒåŒ…å«äº†æ‰€æœ‰å…³äºä½ çš„æ•°æ®åº“è¿æ¥ã€è¿ç§»æ–‡ä»¶å¤¹å’Œæ¨¡å¼æ–‡ä»¶çš„ä¿¡æ¯ã€‚

åœ¨ä½ çš„é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª `drizzle.config.ts` æ–‡ä»¶å¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

```typescript copy filename="drizzle.config.ts"
import { config } from 'dotenv';
import { defineConfig } from "drizzle-kit";

config({ path: '.env' });

export default defineConfig({
  schema: "./src/db/schema.ts",
  out: "./migrations",
  dialect: "postgresql",
  dbCredentials: {
    url: process.env.DATABASE_URL!,
  },
});
```

#### å°†æ›´æ”¹åº”ç”¨åˆ°æ•°æ®åº“

ä½ å¯ä»¥ä½¿ç”¨ `drizzle-kit generate` å‘½ä»¤ç”Ÿæˆè¿ç§»æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨ `drizzle-kit migrate` å‘½ä»¤è¿è¡Œå®ƒä»¬ã€‚

ç”Ÿæˆè¿ç§»ï¼š

```bash
npx drizzle-kit generate
```

è¿™äº›è¿ç§»æ–‡ä»¶å­˜å‚¨åœ¨ `drizzle/migrations` ç›®å½•ä¸­ï¼Œå¦‚ä½ çš„ `drizzle.config.ts` ä¸­æŒ‡å®šçš„é‚£æ ·ã€‚è¿™ä¸ªç›®å½•å°†åŒ…å«æ›´æ–°æ•°æ®åº“æ¨¡å¼æ‰€éœ€çš„ SQL æ–‡ä»¶å’Œä¸€ä¸ªç”¨äºå­˜å‚¨ä¸åŒè¿ç§»é˜¶æ®µæ¨¡å¼å¿«ç…§çš„ `meta` æ–‡ä»¶å¤¹ã€‚

ç”Ÿæˆçš„è¿ç§»ç¤ºä¾‹ï¼š

```sql
CREATE TABLE IF NOT EXISTS "todo" (
	"id" integer PRIMARY KEY NOT NULL,
	"text" text NOT NULL,
	"done" boolean DEFAULT false NOT NULL
);
```

è¿è¡Œè¿ç§»ï¼š

```bash
npx drizzle-kit migrate
```

æˆ–è€…ï¼Œä½ å¯ä»¥ä½¿ç”¨ [Drizzle kit push å‘½ä»¤](/docs/kit-overview#prototyping-with-db-push) ç›´æ¥å°†æ›´æ”¹æ¨é€åˆ°æ•°æ®åº“ï¼š

```bash
npx drizzle-kit push
```

<Callout type="warning">Push å‘½ä»¤é€‚ç”¨äºéœ€è¦åœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒä¸­å¿«é€Ÿæµ‹è¯•æ–°æ¨¡å¼è®¾è®¡æˆ–æ›´æ”¹çš„æƒ…å†µï¼Œå…è®¸å¿«é€Ÿè¿­ä»£è€Œæ— éœ€ç®¡ç†è¿ç§»æ–‡ä»¶çš„å¼€é”€ã€‚</Callout>
</Steps>

#### å»ºç«‹æœåŠ¡å™¨ç«¯å‡½æ•°
åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬åœ¨ **src/actions/todoAction.ts** æ–‡ä»¶ä¸­å»ºç«‹æœåŠ¡å™¨ç«¯å‡½æ•°æ¥å¤„ç†å¾…åŠäº‹é¡¹çš„å…³é”®æ“ä½œï¼š

1. **`getData`:**
    - ä»æ•°æ®åº“è·å–æ‰€æœ‰ç°æœ‰çš„å¾…åŠäº‹é¡¹ã€‚
2. **`addTodo`:**
    - ä½¿ç”¨æä¾›çš„æ–‡æœ¬å‘æ•°æ®åº“æ·»åŠ æ–°çš„å¾…åŠäº‹é¡¹ã€‚
    - ä½¿ç”¨ **`revalidatePath("/")`** é‡æ–°éªŒè¯ä¸»é¡µã€‚
3. **`deleteTodo`:**
    - æ ¹æ®å…¶å”¯ä¸€ ID ä»æ•°æ®åº“ä¸­åˆ é™¤å¾…åŠäº‹é¡¹ã€‚
    - è§¦å‘ä¸»é¡µçš„é‡æ–°éªŒè¯ã€‚
4. **`toggleTodo`:**
    - åˆ‡æ¢å¾…åŠäº‹é¡¹çš„å®ŒæˆçŠ¶æ€ï¼Œç›¸åº”åœ°æ›´æ–°æ•°æ®åº“ã€‚
    - é‡æ–°éªŒè¯ä¸»é¡µã€‚
5. **`editTodo`:**
    - ä¿®æ”¹æ•°æ®åº“ä¸­ç”± ID æ ‡è¯†çš„å¾…åŠäº‹é¡¹çš„æ–‡æœ¬ã€‚
    - è§¦å‘ä¸»é¡µçš„é‡æ–°éªŒè¯ã€‚

```tsx collapsable copy filename="src/actions/todoAction.ts"
"use server";
import { eq, not } from "drizzle-orm";
import { revalidatePath } from "next/cache";
import { db } from "@/db/drizzle";
import { todo } from "@/db/schema";

export const getData = async () => {
  const data = await db.select().from(todo);
  return data;
};

export const addTodo = async (id: number, text: string) => {
  await db.insert(todo).values({
    id: id,
    text: text,
  });
};

export const deleteTodo = async (id: number) => {
  await db.delete(todo).where(eq(todo.id, id));

  revalidatePath("/");
};

export const toggleTodo = async (id: number) => {
  await db
    .update(todo)
    .set({
      done: not(todo.done),
    })
    .where(eq(todo.id, id));

  revalidatePath("/");
};

export const editTodo = async (id: number, text: string) => {
  await db
    .update(todo)
    .set({
      text: text,
    })
    .where(eq(todo.id, id));

  revalidatePath("/");
};
```

## ä½¿ç”¨ Next.js è®¾ç½®ä¸»é¡µ

<Steps>
#### å®šä¹‰ TypeScript ç±»å‹

åœ¨ `src/types/todoType.ts` ä¸­ä¸ºå¾…åŠäº‹é¡¹å®šä¹‰ä¸€ä¸ª TypeScript ç±»å‹ï¼ŒåŒ…å«ä¸‰ä¸ªå±æ€§ï¼šç±»å‹ä¸º **`number`** çš„ **`id`**ã€ç±»å‹ä¸º **`string`** çš„ **`text`** å’Œç±»å‹ä¸º **`boolean`** çš„ **`done`**ã€‚è¿™ä¸ªåä¸º **`todoType`** çš„ç±»å‹è¡¨ç¤ºåº”ç”¨ä¸­å…¸å‹å¾…åŠäº‹é¡¹çš„ç»“æ„ã€‚

```ts copy filename="src/types/todoType.ts"
export type todoType = {
  id: number;
  text: string;
  done: boolean;
};
```

#### åˆ›å»ºå¾…åŠäº‹é¡¹åº”ç”¨çš„ä¸»é¡µ

1. **`src/components/todo.tsx`:**
    åˆ›å»ºä¸€ä¸ªä»£è¡¨å•ä¸ªå¾…åŠäº‹é¡¹çš„ `Todo` ç»„ä»¶ã€‚å®ƒåŒ…æ‹¬æ˜¾ç¤ºå’Œç¼–è¾‘å¾…åŠäº‹é¡¹æ–‡æœ¬çš„åŠŸèƒ½ï¼Œç”¨å¤é€‰æ¡†æ ‡è®°å®ŒæˆçŠ¶æ€ï¼Œå¹¶æä¾›ç¼–è¾‘ã€ä¿å­˜ã€å–æ¶ˆå’Œåˆ é™¤å¾…åŠäº‹é¡¹çš„æ“ä½œã€‚
2. **`src/components/addTodo.tsx`:**
    `AddTodo` ç»„ä»¶æä¾›ä¸€ä¸ªç®€å•çš„è¡¨å•ï¼Œç”¨äºå‘å¾…åŠäº‹é¡¹åº”ç”¨æ·»åŠ æ–°çš„å¾…åŠäº‹é¡¹ã€‚å®ƒåŒ…æ‹¬ä¸€ä¸ªç”¨äºè¾“å…¥å¾…åŠäº‹é¡¹æ–‡æœ¬çš„è¾“å…¥å­—æ®µå’Œä¸€ä¸ªç”¨äºè§¦å‘æ·»åŠ æ–°å¾…åŠäº‹é¡¹çš„æŒ‰é’®ã€‚
3. **`src/components/todos.tsx`:**
    åˆ›å»º Todos ç»„ä»¶ï¼Œä»£è¡¨å¾…åŠäº‹é¡¹åº”ç”¨çš„ä¸»ç•Œé¢ã€‚å®ƒç®¡ç†å¾…åŠäº‹é¡¹çš„çŠ¶æ€ï¼Œæä¾›åˆ›å»ºã€ç¼–è¾‘ã€åˆ‡æ¢å’Œåˆ é™¤å¾…åŠäº‹é¡¹çš„åŠŸèƒ½ï¼Œå¹¶ä½¿ç”¨ `Todo` ç»„ä»¶æ¸²æŸ“å„ä¸ªå¾…åŠäº‹é¡¹ã€‚

<CodeTabs items={["todo.tsx", "addTodo.tsx", "todos.tsx"]}>
```tsx collapsable copy
"use client";
import { ChangeEvent, FC, useState } from "react";
import { todoType } from "@/types/todoType";

interface Props {
  todo: todoType;
  changeTodoText: (id: number, text: string) => void;
  toggleIsTodoDone: (id: number, done: boolean) => void;
  deleteTodoItem: (id: number) => void;
}

const Todo: FC<Props> = ({
  todo,
  changeTodoText,
  toggleIsTodoDone,
  deleteTodoItem,
}) => {
  // ç”¨äºå¤„ç†ç¼–è¾‘æ¨¡å¼çš„çŠ¶æ€
  const [editing, setEditing] = useState(false);

  // ç”¨äºå¤„ç†æ–‡æœ¬è¾“å…¥çš„çŠ¶æ€
  const [text, setText] = useState(todo.text);

  // ç”¨äºå¤„ç†"å®Œæˆ"çŠ¶æ€çš„çŠ¶æ€
  const [isDone, setIsDone] = useState(todo.done);

  // æ–‡æœ¬è¾“å…¥æ›´æ”¹çš„äº‹ä»¶å¤„ç†ç¨‹åº
  const handleTextChange = (e: ChangeEvent<HTMLInputElement>) => {
    setText(e.target.value);
  };

  // åˆ‡æ¢"å®Œæˆ"çŠ¶æ€çš„äº‹ä»¶å¤„ç†ç¨‹åº
  const handleIsDone = async () => {
    toggleIsTodoDone(todo.id, !isDone);
    setIsDone((prev) => !prev);
  };

  // å¯åŠ¨ç¼–è¾‘æ¨¡å¼çš„äº‹ä»¶å¤„ç†ç¨‹åº
  const handleEdit = () => {
    setEditing(true);
  };

  // ä¿å­˜ç¼–è¾‘æ–‡æœ¬çš„äº‹ä»¶å¤„ç†ç¨‹åº
  const handleSave = async () => {
    changeTodoText(todo.id, text);
    setEditing(false);
  };

  // å–æ¶ˆç¼–è¾‘æ¨¡å¼çš„äº‹ä»¶å¤„ç†ç¨‹åº
  const handleCancel = () => {
    setEditing(false);
    setText(todo.text);
  };

  // åˆ é™¤å¾…åŠäº‹é¡¹çš„äº‹ä»¶å¤„ç†ç¨‹åº
  const handleDelete = () => {
    if (confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå¾…åŠäº‹é¡¹å—ï¼Ÿ")) {
      deleteTodoItem(todo.id);
    }
  };

  // æ¸²æŸ“ Todo ç»„ä»¶
  return (
    <div className="flex items-center gap-2 p-4 border-gray-200 border-solid border rounded-lg">
      {/* ç”¨äºæ ‡è®°å¾…åŠäº‹é¡¹å®Œæˆçš„å¤é€‰æ¡† */}
      <input
        type="checkbox"
        className="text-blue-200 rounded-sm h-4 w-4"
        checked={isDone}
        onChange={handleIsDone}
      />
      {/* å¾…åŠäº‹é¡¹æ–‡æœ¬çš„è¾“å…¥å­—æ®µ */}
      <input
        type="text"
        value={text}
        onChange={handleTextChange}
        readOnly={!editing}
        className={`${
          todo.done ? "line-through" : ""
        } outline-none read-only:border-transparent focus:border border-gray-200 rounded px-2 py-1 w-full`}
      />
      {/* ç¼–è¾‘ã€ä¿å­˜ã€å–æ¶ˆå’Œåˆ é™¤çš„æ“ä½œæŒ‰é’® */}
      <div className="flex gap-1 ml-auto">
        {editing ? (
          <button
            onClick={handleSave}
            className="bg-green-600 text-green-50 rounded px-2 w-14 py-1"
          >
            ä¿å­˜
          </button>
        ) : (
          <button
            onClick={handleEdit}
            className="bg-blue-400 text-blue-50 rounded w-14 px-2 py-1"
          >
            ç¼–è¾‘
          </button>
        )}
        {editing ? (
          <button
            onClick={handleCancel}
            className="bg-red-400 w-16 text-red-50 rounded px-2 py-1"
          >
            å…³é—­
          </button>
        ) : (
          <button
            onClick={handleDelete}
            className="bg-red-400 w-16 text-red-50 rounded px-2 py-1"
          >
            åˆ é™¤
          </button>
        )}
      </div>
    </div>
  );
};

export default Todo;
```
```tsx collapsable copy
"use client";
import { ChangeEvent, FC, useState } from "react";

interface Props {
  createTodo: (value: string) => void;
}

const AddTodo: FC<Props> = ({ createTodo }) => {
  // ç”¨äºå¤„ç†è¾“å…¥å€¼çš„çŠ¶æ€
  const [input, setInput] = useState("");

  // è¾“å…¥æ›´æ”¹çš„äº‹ä»¶å¤„ç†ç¨‹åº
  const handleInput = (e: ChangeEvent<HTMLInputElement>) => {
    setInput(e.target.value);
  };

  // æ·»åŠ æ–°å¾…åŠäº‹é¡¹çš„äº‹ä»¶å¤„ç†ç¨‹åº
  const handleAdd = async () => {
    createTodo(input);
    setInput("");
  };

  // æ¸²æŸ“ AddTodo ç»„ä»¶
  return (
    <div className="w-full flex gap-1 mt-2">
      {/* ç”¨äºè¾“å…¥æ–°å¾…åŠäº‹é¡¹æ–‡æœ¬çš„è¾“å…¥å­—æ®µ */}
      <input
        type="text"
        className="w-full px-2 py-1 border border-gray-200 rounded outline-none"
        onChange={handleInput}
        value={input}
      />
      {/* ç”¨äºæ·»åŠ æ–°å¾…åŠäº‹é¡¹çš„æŒ‰é’® */}
      <button
        className="flex items-center justify-center bg-green-600 text-green-50 rounded px-2 h-9 w-14 py-1"
        onClick={handleAdd}
      >
        æ·»åŠ 
      </button>
    </div>
  );
};

export default AddTodo;
```

	<CodeTab>
```tsx collapsable copy
"use client";
import { FC, useState } from "react";
import { todoType } from "@/types/todoType";
import Todo from "./todo";
import AddTodo from "./addTodo";
import { addTodo, deleteTodo, editTodo, toggleTodo } from "@/actions/todoAction";

interface Props {
  todos: todoType[];
}

const Todos: FC<Props> = ({ todos }) => {
  // ç”¨äºç®¡ç†å¾…åŠäº‹é¡¹åˆ—è¡¨çš„çŠ¶æ€
  const [todoItems, setTodoItems] = useState<todoType[]>(todos);

  // åˆ›å»ºæ–°å¾…åŠäº‹é¡¹çš„å‡½æ•°
  const createTodo = (text: string) => {
    const id = (todoItems.at(-1)?.id || 0) + 1;
    addTodo(id, text);
    setTodoItems((prev) => [...prev, { id: id, text, done: false }]);
  };

  // æ›´æ”¹å¾…åŠäº‹é¡¹æ–‡æœ¬çš„å‡½æ•°
  const changeTodoText = (id: number, text: string) => {
    setTodoItems((prev) =>
      prev.map((todo) => (todo.id === id ? { ...todo, text } : todo))
    );
    editTodo(id, text);
  };

  // åˆ‡æ¢å¾…åŠäº‹é¡¹"å®Œæˆ"çŠ¶æ€çš„å‡½æ•°
  const toggleIsTodoDone = (id: number) => {
    setTodoItems((prev) =>
      prev.map((todo) => (todo.id === id ? { ...todo, done: !todo.done } : todo))
    );
    toggleTodo(id);
  };

  // åˆ é™¤å¾…åŠäº‹é¡¹çš„å‡½æ•°
  const deleteTodoItem = (id: number) => {
    setTodoItems((prev) => prev.filter((todo) => todo.id !== id));
    deleteTodo(id);
  };

  // æ¸²æŸ“å¾…åŠäº‹é¡¹åˆ—è¡¨ç»„ä»¶
  return (
    <main className="flex mx-auto max-w-xl w-full min-h-screen flex-col items-center p-16">
      <div className="text-5xl font-medium">å¾…åŠäº‹é¡¹åº”ç”¨</div>
      <div className="w-full flex flex-col mt-8 gap-2">
        {/* éå† todoItems å¹¶ä¸ºæ¯ä¸ªé¡¹ç›®æ¸²æŸ“ Todo ç»„ä»¶ */}
        {todoItems.map((todo) => (
          <Todo
            key={todo.id}
            todo={todo}
            changeTodoText={changeTodoText}
            toggleIsTodoDone={toggleIsTodoDone}
            deleteTodoItem={deleteTodoItem}
          />
        ))}
      </div>
      {/* æ·»åŠ ç”¨äºåˆ›å»ºæ–°å¾…åŠäº‹é¡¹çš„ AddTodo ç»„ä»¶ */}
      <AddTodo createTodo={createTodo} />
    </main>
  );
};

export default Todos;
```

    </CodeTab>
</CodeTabs>

æ›´æ–° `src/app` æ–‡ä»¶å¤¹ä¸­çš„ `page.tsx` æ–‡ä»¶ä»¥ä»æ•°æ®åº“è·å–å¾…åŠäº‹é¡¹å¹¶æ¸²æŸ“ `Todos` ç»„ä»¶ï¼š

```tsx copy filename="src/app/page.tsx"
import { getData } from "@/actions/todoAction";
import Todos from "@/components/todos";

export default async function Home() {
  const data = await getData();
  return <Todos todos={data} />;
}
```
</Steps>

## åŸºæœ¬æ–‡ä»¶ç»“æ„

æœ¬æŒ‡å—ä½¿ç”¨ä»¥ä¸‹æ–‡ä»¶ç»“æ„ï¼š

```text
ğŸ“¦ <project root>
 â”œ ğŸ“‚ migrations
 â”‚  â”œ ğŸ“‚ meta
 â”‚  â”” ğŸ“œ 0000_heavy_doctor_doom.sql
 â”œ ğŸ“‚ public
 â”œ ğŸ“‚ src
 â”‚  â”œ ğŸ“‚ actions
 â”‚  â”‚  â”” ğŸ“œ todoActions.ts
 â”‚  â”œ ğŸ“‚ app
 â”‚  â”‚  â”œ ğŸ“œ favicon.ico
 â”‚  â”‚  â”œ ğŸ“œ globals.css
 â”‚  â”‚  â”œ ğŸ“œ layout.tsx
 â”‚  â”‚  â”” ğŸ“œ page.tsx
 â”‚  â”œ ğŸ“‚ components
 â”‚  â”‚  â”œ ğŸ“œ addTodo.tsx
 â”‚  â”‚  â”œ ğŸ“œ todo.tsx
 â”‚  â”‚  â”” ğŸ“œ todos.tsx
 â”‚  â”” ğŸ“‚ db
 â”‚  â”‚  â”œ ğŸ“œ drizzle.ts
 â”‚  â”‚  â”” ğŸ“œ schema.ts
 â”‚  â”” ğŸ“‚ types
 â”‚     â”” ğŸ“œ todoType.ts
 â”œ ğŸ“œ .env
 â”œ ğŸ“œ .eslintrc.json
 â”œ ğŸ“œ .gitignore
 â”œ ğŸ“œ drizzle.config.ts
 â”œ ğŸ“œ next-env.d.ts
 â”œ ğŸ“œ next.config.mjs
 â”œ ğŸ“œ package-lock.json
 â”œ ğŸ“œ package.json
 â”œ ğŸ“œ postcss.config.mjs
 â”œ ğŸ“œ README.md
 â”œ ğŸ“œ tailwind.config.ts
 â”” ğŸ“œ tsconfig.json
```
